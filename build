#! /usr/bin/env bash

OS="Unknown-OS"
ROOT=`pwd`
case "$OSTYPE" in
  solaris*) OS="Solaris" ;;
  darwin*)  OS="MacOSX" ;; 
  linux*)   OS="Linux" ;;
  bsd*)     OS="FreeBSD" ;;
  *)        OS="Unknown-$OSTYPE" ;;
esac

echo "[fastype] Build for $OS"

# git submodules
git submodule update --init
cd src/boost && git submodule update --init && cd $ROOT

# third party library
if [ ! -d src/boost/boost ]; then
    echo "[fastype] prepare *Boost* library for $OS"
    cd src/boost 
    ./bootstrap.sh && ./b2 headers 
    cd $ROOT
fi
if [ ! -d src/icu/build ]; then
    echo "[fastype] prepare *ICU4C* library for $OS"
    mkdir -p src/icu/build
    cd src/icu/build
    ../icu4c/source/runConfigureICU $OS && make -j6 check
    cd $ROOT
fi

# build folder
cd $ROOT
DEBUG=debug
RELEASE=release
if [ ! -d $DEBUG ]; then mkdir $DEBUG; fi
if [ ! -d $RELEASE ]; then mkdir $RELEASE; fi

# build
cd $DEBUG && cmake -DCMAKE_BUILD_TYPE=Debug ../src && make VERBOSE=1 && cd $ROOT
cd $RELEASE && cmake -DCMAKE_BUILD_TYPE=Release ../src && make VERBOSE=1 && cd $ROOT
